The code is mostly awful but it is what it is.
